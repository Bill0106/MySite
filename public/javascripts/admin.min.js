var myAdmin=angular.module("myAdmin",["ui.router","ngResource","ngFileUpload","adminRoutes","gamesController","gameController","gourmetsController","gourmetController","cardsController","hearthStoneSeasonController","hearthStoneSeasonsController","gamesService","gourmetsService","cardsService","countService","myConfig"]);myAdmin.run(function($rootScope,$state,$http){$http.defaults.headers.common.auth="ljpon3UUVTMMmIhE6Kcf",$http.defaults.headers.post.auth="HNoHW7HUKEYxW5DFxaVj",$rootScope.imagePath="http://zhuhaolin.com/images/",$rootScope.$on("$stateChangeSuccess",function(){$rootScope.title=$state.current.title})}),myAdmin.controller("imageUploadController",["$scope","Upload",function($scope,Upload){$scope.$watch("file",function(file){file&&$scope.upload($scope.file)}),$scope.upload=function(file){Upload.upload({url:"/api/images",file:file}).progress(function(evt){$scope.uploading=!0,$scope.progress=parseInt(100*evt.loaded/evt.total)}).success(function(data,status,headers,config){$scope.progress=0,$scope.success=!0,$scope.imageName=data}).error(function(data,status,headers,config){$scope.fail=!0,$scope.msg=data})}}]);var gameController=angular.module("gameController",[]);gameController.controller("gameController",function($scope,$filter,$state,$stateParams,Game,GAME_PLATFORMS,GAME_GENRES){$scope.game=new Game,"add"!=$stateParams.url&&Game.get({game_url:$stateParams.url},function(data){$scope.game=data}),$scope.$watch("game.release_at",function(newValue){$scope.game.release_at=$filter("date")(newValue,"yyyy-MM-dd")}),$scope.$watch("game.buy_at",function(newValue){$scope.game.buy_at=$filter("date")(newValue,"yyyy-MM-dd")}),$scope.fields=["title","name","developer","publisher","release_at","buy_at","rate","image"],$scope.platforms=GAME_PLATFORMS,$scope.genres=GAME_GENRES,$scope.createGame=function(){$scope.game.$save(function(data){data.success?$state.go("games"):($scope.show=!0,$scope.result=data.msg)})}});var gamesController=angular.module("gamesController",[]);gamesController.controller("gamesController",function($scope,Game,Count,GAME_PLATFORMS,GAME_GENRES){Count.get({model:"games"},function(count){$scope.count=count.count,$scope.games=Game.query({limit:count.count})}),$scope.platforms=GAME_PLATFORMS,$scope.genres=GAME_GENRES});var gourmetController=angular.module("gourmetController",[]);gourmetController.controller("gourmetController",function($scope,$filter,$state,$stateParams,Gourmet){$scope.gourmet=new Gourmet,"add"!=$stateParams.url&&Gourmet.get({id:$stateParams.id},function(data){$scope.gourmet=data}),$scope.$watch("gourmet.date",function(newValue){$scope.gourmet.date=$filter("date")(newValue,"yyyy-MM-dd")}),$scope.fields=["food","restaurant","date","image","url"],$scope.createGourmet=function(){$scope.gourmet.$save(function(data){data.success?$state.go("gourmets"):($scope.show=!0,$scope.result=data.msg)})}});var gourmetsController=angular.module("gourmetsController",[]);gourmetsController.controller("gourmetsController",function($scope,Gourmet,Count){Count.get({model:"gourmets"},function(count){$scope.count=count.count,$scope.gourmets=Gourmet.query({limit:count.count})})});var cardsController=angular.module("cardsController",[]);cardsController.controller("cardsController",function($scope,Card,Count){function checkCard(item,object){for(var count=0,i=0;i<object.length;i++)if(item._id==object[i]._id&&count++,2==count)return!1;return!0}$scope.playerClass=["Druid","Hunter","Mage","Paladin","Priest","Rogue","Shaman","Warlock","Warrior"],$scope.neutralPage=0,$scope.classPage=0,Card.query(function(data){$scope.neutralCards=data}),$scope.getClassCards=function(index){$scope.selectedClass=index,$scope.classPage=0,Card.query({playerClass:index},function(data){$scope.classCards=data})},$scope.getMoreCards=function(type,more){var playerClass=-1,page=$scope.neutralPage;"class"==type&&(playerClass=$scope.selectedClass,page=$scope.classPage),Count.get({model:"cards",playerClass:playerClass},function(count){if("prev"==more&&0!==page)page-=1;else{if(!("next"==more&&page<Math.ceil(count.count/12)-1))return!1;page+=1}Card.query({playerClass:playerClass,offset:page},function(data){"class"==type?($scope.classCards=data,$scope.classPage=page):($scope.neutralCards=data,$scope.neutralPage=page)})})},$scope.deckCards=[],$scope.addCard=function(card){$scope.deckCards.length>1?checkCard(card,$scope.deckCards)&&$scope.deckCards.push(card):$scope.deckCards.push(card)}});var hearthStoneSeason=angular.module("hearthStoneSeasonController",["hearthStoneSeasonsService"]);hearthStoneSeason.controller("hearthStoneSeason",function($scope,$state,$stateParams,HearthStoneSeason){$scope.season=new HearthStoneSeason,$scope.createSeason=function(){$scope.season.$save(function(data){data.success?$state.go("hearthStoneSeasons"):($scope.show=!0,$scope.result=data.msg)})}});var hearthStoneSeasons=angular.module("hearthStoneSeasonsController",["hearthStoneSeasonsService"]);hearthStoneSeasons.controller("hearthStoneSeasons",function($scope,HearthStoneSeason){$scope.seasons=HearthStoneSeason.query()});var countService=angular.module("countService",[]);countService.factory("Count",function($resource){return $resource("/api/count/:model")});var gamesService=angular.module("gamesService",[]);gamesService.factory("Game",function($resource){return $resource("/api/games/:game_url")});var gourmetsService=angular.module("gourmetsService",[]);gamesService.factory("Gourmet",function($resource){return $resource("/api/gourmets/:id")});var cardsService=angular.module("cardsService",[]);cardsService.factory("Card",function($resource){return $resource("/api/hearth-stone/cards")});var hearthStoneSeasonsService=angular.module("hearthStoneSeasonsService",[]);hearthStoneSeasonsService.factory("HearthStoneSeason",function($resource){return $resource("/api/hearth-stone/seasons")}),angular.module("adminRoutes",[]).config(function($stateProvider,$urlRouterProvider,$locationProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("index",{url:"/admin",templateUrl:"/views/admin/index.html",title:"Home"}).state("games",{url:"/admin/games",templateUrl:"/views/admin/games.html",controller:"gamesController",title:"Games"}).state("game",{url:"/admin/games/:url",templateUrl:"/views/admin/game.html",controller:"gameController",title:"Game"}).state("gourmets",{url:"/admin/gourmets",templateUrl:"/views/admin/gourmets.html",controller:"gourmetsController",title:"Gourmets"}).state("gourmet",{url:"/admin/gourmets/:id",templateUrl:"/views/admin/gourmet.html",controller:"gourmetController",title:"Gourmet"}).state("hearthStoneSeasons",{url:"/admin/hearth-stone/seasons",templateUrl:"/views/admin/hearthStone/seasons.html",controller:"hearthStoneSeasons",title:"Hearth Stone Seasons"}).state("hearthStoneSeason",{url:"/admin/hearth-stone/season",templateUrl:"/views/admin/hearthStone/season.html",controller:"hearthStoneSeason",title:"Hearth Stone Season"}),$locationProvider.html5Mode({enabled:!0,requireBase:!1})});var gamePlatforms=[{value:0,name:"PlayStation 3"},{value:1,name:"PlayStation Vita"},{value:2,name:"PlayStation 4"}],gameGenres=[{value:0,name:"Action"},{value:1,name:"Adventure"},{value:2,name:"Fighting"},{value:3,name:"Racing"},{value:4,name:"Role-Playing"},{value:5,name:"Sports"},{value:6,name:"Third-person shooter"},{value:7,name:"Strategy"}],myConfig=angular.module("myConfig",[]).constant("GAME_PLATFORMS",gamePlatforms).constant("GAME_GENRES",gameGenres);