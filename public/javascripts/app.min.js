var myApp=angular.module("myApp",["ui.router","ngResource","infinite-scroll","appRoutes","homeController","gamesController","gameController","gourmetsController","gamesService","gourmetsService","countService","myConfig"]);myApp.run(function($rootScope,$state,$http){$http.defaults.headers.common.auth="ljpon3UUVTMMmIhE6Kcf",$rootScope.imagePath="http://zhuhaolin.com/images/",$rootScope.$on("$stateChangeSuccess",function(){$rootScope.bodyClass=$state.current.controller,$rootScope.title=$state.current.title})}),myApp.directive("ngLoading",function(){return{restrict:"A",replace:!0,scope:{val:"=loadImages"},require:"ngModel",link:function(scope,element,attrs,ngModel){function progressIncrease(total){var mask=$("[data-load='mask']"),progress=$("[data-load='progress']",mask),count=progress.data("count");count++;var percentage=Math.floor(count/total*100);progress.css("width",percentage+"%").attr("aria-valuenow",percentage).text(percentage+"%").data("count",count),count==total&&(ngModel.$setViewValue(!0),ngModel.$render())}function loadImage(item,total){var image=new Image,path=scope.$root.imagePath,src=path+item;$(image).attr("src",src).bind("load",function(){progressIncrease(total)})}scope.$watch("val",function(newValue,oldValue){if(newValue){var total=scope.val.length;angular.forEach(scope.val,function(value){loadImage(value,total)})}})}}});var gameController=angular.module("gameController",[]);gameController.controller("gameController",function($scope,$rootScope,$state,Game,GAME_PLATFORMS,GAME_GENRES){Game.get({game_url:$state.params.url},function(data){$rootScope.title=data.name+"_My Games",$scope.game=data}),$scope.platforms=GAME_PLATFORMS,$scope.genres=GAME_GENRES,$scope.rateText=["Terrible","Poor","Fair","Good","Great"],$scope.getParagraph=function(text){return text?text.split("\n"):void 0}});var gamesController=angular.module("gamesController",[]);gamesController.controller("gamesController",function($scope,Game,Count){$scope.show=!0;var count=20,limit=12;Game.query({limit:count},function(data){$scope.games=data,$scope.images=[],angular.forEach(data,function(value){$scope.images.push(value.image)})}),Count.get({model:"games"},function(data){$scope.loadMore=function(){return $scope.busy=!0,count>=data.count?($scope.show=!1,!1):(Game.query({offset:count,limit:limit},function(data){$scope.moreImages=[],angular.forEach(data,function(value){$scope.games.push(value),$scope.moreImages.push(value.image)})}),void(count+=limit))}}),$scope.loadComplete=function(complete){complete&&($scope.complete=!0)},$scope.getNumber=function(num){return new Array(num)}}),gamesController.directive("ngGames",function(){return{restrict:"A",replace:!0,scope:{complete:"=loadComplete",busy:"=scrollBusy",val:"=gameImages"},link:function(scope,element,attrs){function imageLoading(item,callback){var path=scope.$root.imagePath,src=path+item,image=new Image;$(image).attr("src",src).bind("load",function(){callback()})}function loadMore(){scope.$watch("val",function(newValue){if(newValue){var count=0,total=newValue.length;angular.forEach(newValue,function(item){imageLoading(item,function(){count++,count==total&&($("[data-games-item]").removeClass("hidden"),scope.busy=!1,scope.$apply())})})}})}function showContent(){element.removeClass("hidden"),$("[data-games-item]").removeClass("hidden"),setTimeout(function(){$("[data-load='mask']").fadeOut(),loadMore()},300)}scope.$watch("complete",function(complete){complete&&showContent()})}}});var gourmetsController=angular.module("gourmetsController",[]);gourmetsController.controller("gourmetsController",function($scope,Gourmet,Count){$scope.show=!0;var count=24,limit=18;Gourmet.query({limit:count},function(data){$scope.gourmets=data,$scope.images=[],angular.forEach(data,function(item){$scope.images.push(item.image)})}),Count.get({model:"gourmets"},function(data){$scope.loadMore=function(){return $scope.busy=!0,count>=data.count?($scope.show=!1,!1):(Gourmet.query({offset:count,limit:limit},function(data){$scope.moreImages=[],angular.forEach(data,function(value){$scope.gourmets.push(value),$scope.moreImages.push(value.image)})}),void(count+=limit))}}),$scope.loadComplete=function(complete){complete&&($scope.complete=!0)}}),gourmetsController.directive("ngGourmets",function(){return{restrict:"A",replace:!0,scope:{complete:"=loadComplete",busy:"=scrollBusy",val:"=gourmetImages"},link:function(scope,element,attrs){function imageLoading(item,callback){var path=scope.$root.imagePath,src=path+item,image=new Image;$(image).attr("src",src).bind("load",function(){callback()})}function loadMore(){scope.$watch("val",function(newValue){if(newValue){var count=0,total=newValue.length;angular.forEach(newValue,function(item){imageLoading(item,function(){count++,count==total&&($("[data-gourmet-item]").removeClass("hidden"),scope.busy=!1,scope.$apply())})})}})}function showContent(){element.removeClass("hidden"),$("[data-gourmet-item]").removeClass("hidden"),setTimeout(function(){$("[data-load='mask']").fadeOut(),loadMore()},300)}scope.$watch("complete",function(complete){complete&&showContent()})}}});var homeController=angular.module("homeController",[]);homeController.controller("homeController",function($scope){$scope.items=[{title:"Bill's Hobby - Write as a Interest",icon:"1b11d8d7a005a06b42514f5d9022e1df.jpg",background:"73ad5a84dcefe956276f1bd07c6316dd.jpg"},{title:"PlayStation Games",icon:"84abb1fdfd670845666ac89f712b539a.jpg",background:"66a7d162d0bdf9aa302e280cbb5d90d6.jpg",url:"games"},{title:"Gourmet Tour",icon:"09d6aeb87783661768b52c73f18c3069.jpg",background:"a15bc6b5656eb67d2e0cde3c2e7f583a.jpg",url:"gourmets"},{title:"HearthStone",icon:"fd7f11741da6dd01db206a29d0536427.jpg",background:"5233e5089e1ff5fff7a85c8aa13304ff.jpg"},{title:"Manchester United",icon:"a8ae912e1037ff7b5e75d4660682bf12.jpg",background:"abb4387b620523942e197d39bf38b611.jpg"},{title:"Gyakuten Saiban",icon:"4b654282902acbaf2b3ac3051b574717.jpg",background:"566b87a4710605f312ec139dcd71088a.jpg"}],$scope.images=[],angular.forEach($scope.items,function(value){$scope.images.push(value.background),$scope.images.push(value.icon)}),$scope.loadComplete=function(complete){complete&&($scope.complete=!0)}}),homeController.directive("ngHome",function(){return{restrict:"A",replace:!0,scope:{complete:"=loadComplete"},link:function(scope,element,attrs){function startCarousel(){var carousel=$("[data-app-index='carousel']"),carouselSlide=$("[data-slide]",carousel),pause=$("[data-app-index='pauseCarousel']");carousel.carousel({pause:"false"}),pause.hover(function(){carousel.carousel("pause")},function(){carousel.carousel("cycle")}),carouselSlide.click(function(e){e.preventDefault()})}function showContent(){setTimeout(function(){$("[data-load='mask']").fadeOut(),startCarousel()},300)}scope.$watch("complete",function(complete){complete&&showContent()})}}});var countService=angular.module("countService",[]);countService.factory("Count",function($resource){return $resource("/api/count/:model")});var gamesService=angular.module("gamesService",[]);gamesService.factory("Game",function($resource){return $resource("/api/games/:game_url")});var gourmetsService=angular.module("gourmetsService",[]);gamesService.factory("Gourmet",function($resource){return $resource("/api/gourmets/:id")}),angular.module("appRoutes",[]).config(function($stateProvider,$urlRouterProvider,$locationProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("index",{url:"/",templateUrl:"/views/app/index.html",controller:"homeController",title:"Home"}).state("games",{url:"/games",templateUrl:"/views/app/games.html",controller:"gamesController",title:"My Games"}).state("game",{url:"/games/:url.html",templateUrl:"/views/app/game.html",controller:"gameController",title:"Game"}).state("gourmets",{url:"/gourmets",templateUrl:"/views/app/gourmets.html",controller:"gourmetsController",title:"My Gourmets Tour"}),$locationProvider.html5Mode({enabled:!0,requireBase:!1})});var gamePlatforms=[{value:0,name:"PlayStation 3"},{value:1,name:"PlayStation Vita"},{value:2,name:"PlayStation 4"}],gameGenres=[{value:0,name:"Action"},{value:1,name:"Adventure"},{value:2,name:"Fighting"},{value:3,name:"Racing"},{value:4,name:"Role-Playing"},{value:5,name:"Sports"},{value:6,name:"Third-person shooter"},{value:7,name:"Strategy"}],myConfig=angular.module("myConfig",[]).constant("GAME_PLATFORMS",gamePlatforms).constant("GAME_GENRES",gameGenres);