var myApp=angular.module("myApp",["ngRoute","ngAnimate","infinite-scroll","appRoutes","homeCtrl","homeService","playStationCtrl","playStationService","gameCtrl","gameService"]);myApp.controller("titleController",function($scope,$route,Game){$scope.$on("$routeChangeSuccess",function(){"Game"==$route.current.title?Game.get($route.current.params.url).success(function(data){$scope.title=data.name}):$scope.title=$route.current.title})}),myApp.controller("headerController",function($scope,$location){$scope.isActive=function(viewLocation){return viewLocation===$location.path()}}),myApp.run(function($http){$http.defaults.headers.common.auth="ljpon3UUVTMMmIhE6Kcf"}),angular.module("appRoutes",[]).config(["$routeProvider","$locationProvider",function($routeProvider,$locationProvider){$routeProvider.when("/",{templateUrl:"/views/index.html",controller:"homeController",title:"Home"}).when("/playstation",{templateUrl:"/views/playstation.html",controller:"playStationController",title:"PlayStation"}).when("/game/:url",{templateUrl:"/views/game.html",controller:"gameController",title:"Game"}).otherwise({redirectTo:"/"}),$locationProvider.html5Mode(!0)}]);var gameCtrl=angular.module("gameCtrl",[]);gameCtrl.controller("gameController",function($scope,$routeParams,Game){Game.get($routeParams.url).success(function(data){$scope.game=data,$scope.image=data.image,$scope.descriptions=data.description.split("\n");var companies=data.company.split("/");"1"==companies.length?($scope.developer=data.company,$scope.publish=data.company):($scope.developer=companies[0],$scope.publish=companies[1])})}),gameCtrl.directive("ngGame",["$timeout",function(timer){return{restrict:"A",replace:!0,scope:{val:"=gameModel"},link:function(scope){$("div.page-loading").removeClass("fadeOut").addClass("fadeIn");var imageLoad=function(){var image=new Image,src="http://zhuhaolin.com/images/"+scope.val.image;$(image).attr("src",src).bind("load",function(){$("div.page-loading").removeClass("fadeIn").addClass("fadeOut"),setTimeout(function(){$("section.game-detail").addClass("fadeIn")},350)})};timer(imageLoad,100)}}}]);var homeCtrl=angular.module("homeCtrl",[]);homeCtrl.controller("homeController",function($scope,homeLinks){$scope.formData={},homeLinks.get().success(function(data){$scope.homeLinks=data}),$scope.mouseEnter=function(homeLink){$scope.title=homeLink.title},$scope.mouseLeave=function(){$scope.title=""}}),homeCtrl.directive("ngHome",["$timeout",function(timer){return{restrict:"A",replace:!0,link:function(scope,element){var imageLoad=function(){var backgroundImage=new Image;$(backgroundImage).attr("src","http://bill0106.com/images/505afb6ff668f345f4b5ea4cd1fba976.jpg").bind("load",function(){$("div.page-loading").addClass("animated fadeOut"),setTimeout(function(){element.addClass("animated fadeIn")},350)})};timer(imageLoad,0)}}}]);var playStationCtrl=angular.module("playStationCtrl",[]);playStationCtrl.controller("playStationController",function($scope,Games){$scope.busy=!0,Games.get().success(function(data){var gamesData=data.reverse(),length=gamesData.length;$scope.games=gamesData.splice(0,24),$scope.loadMore=function(){if($scope.busy=!0,0===length)return!1;var num=12;num>length&&(num=length);var moreGames=gamesData.splice(0,num);angular.forEach(moreGames,function(value){$scope.games.push(value)})}}),$scope.getNumber=function(num){return new Array(num)}}),playStationCtrl.directive("ngPlayStation",["$timeout",function(timer){return{restrict:"A",replace:!0,scope:{val:"=gamesModel",busy:"=scrollBusy"},link:function(scope){$(".progress").removeClass("fadeOut").addClass("fadeIn");var playStation=function(){var length=$("div.playstation-game-item").length,visible=$("div.playstation-game-item[class$='fadeIn']").length,pageLoad=$(".playstation-page-loading"),count=0;0!==visible&&pageLoad.removeClass("fadeOut").addClass("page-loading-show fadeIn");for(var i=0;length>i;i++){var item=$("div.playstation-game-item").eq(i),image=$(".game-item-image",item);image.bind("load",function(){count++;var value=Math.round(count/length*100);$(".progress-bar").css("width",value+"%").attr("aria-valuenow",value).text(value+"%"),count+visible==length&&(pageLoad.removeClass("fadeIn").addClass("fadeOut"),$(".playstation-game-item").css("display","block"),setTimeout(function(){$(".playstation-game-item").addClass("fadeIn"),pageLoad.removeClass("page-loading-show"),$(".progress").removeClass("fadeIn").addClass("fadeOut"),scope.busy=!1,scope.$apply()},350))})}$(".playstation-game-item").hover(function(){$(".game-item-image",$(this)).addClass("flipOutY")},function(){$(".game-item-image",$(this)).removeClass("flipOutY").addClass("animated flipInY")})};scope.$watch("val",function(newValue){newValue&&timer(playStation,200)},!0)}}}]);var gameService=angular.module("gameService",[]);gameService.factory("Game",function($http){return{get:function(game_url){return $http.get("/api/game/"+game_url)}}});var homeService=angular.module("homeService",[]);homeService.factory("homeLinks",function($http){return{get:function(){return $http.get("/api/homelinks")}}});var playStationService=angular.module("playStationService",[]);playStationService.factory("Games",function($http){return{get:function(){return $http.get("/api/games")}}});