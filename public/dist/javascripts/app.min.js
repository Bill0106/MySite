var imagePath="http://zhuhaolin.com/images/",myApp=angular.module("myApp",["ngRoute","ngAnimate","infinite-scroll","appRoutes","homeCtrl","playStationCtrl","playStationService","gameCtrl","gameService","gourmetCtrl","gourmetService"]);myApp.controller("headerController",function($scope,$location){$scope.isActive=function(viewLocation){return viewLocation===$location.path()}}),myApp.run(function($rootScope,$http,Game){$http.defaults.headers.common.auth="ljpon3UUVTMMmIhE6Kcf",$rootScope.$on("$routeChangeSuccess",function(ev,data){data.$$route&&data.$$route.controller&&($rootScope.controller=data.$$route.controller),data.$$route&&data.$$route.title&&($rootScope.title=data.$$route.title),data.params&&data.params.url&&Game.get(data.params.url).success(function(obj){$rootScope.title=obj.name+"_PlayStation Game"})})}),angular.module("appRoutes",[]).config(["$routeProvider","$locationProvider",function($routeProvider,$locationProvider){$routeProvider.when("/",{templateUrl:"/views/index/index.html",controller:"homeController",title:"Home"}).when("/playstation",{templateUrl:"/views/playstation/playstation.html",controller:"playStationController",title:"PlayStation"}).when("/game/:url",{templateUrl:"/views/playstation/game.html",controller:"gameController",title:"Game"}).when("/gourmet",{templateUrl:"/views/gourmet/gourmet.html",controller:"gourmetController",title:"Gourmet"}).otherwise({redirectTo:"/"}),$locationProvider.html5Mode(!0)}]);var gameCtrl=angular.module("gameCtrl",[]);gameCtrl.controller("gameController",function($scope,$routeParams,Game){Game.get($routeParams.url).success(function(data){$scope.imagePath=imagePath,$scope.game=data,$scope.descriptions=data.description.split("\n");var rateText=["Terrible","Poor","Fair","Good","Great"];$scope.rateText=rateText[data.rate-1];var companies=data.company.split("/");"1"==companies.length?($scope.developer=data.company,$scope.publish=data.company):($scope.developer=companies[0],$scope.publish=companies[1])})}),gameCtrl.directive("ngGame",["$timeout",function(timer){return{restrict:"A",replace:!0,scope:{val:"=gameModel"},link:function(scope){var pageLoading=$("[data-component='pageLoading']");pageLoading.addClass("fadeIn");var game=function(){var image=new Image,src=imagePath+scope.val.image,rate=scope.val.rate/5*100;$(image).attr("src",src).bind("load",function(){pageLoading.removeClass("fadeIn").addClass("fadeOut"),setTimeout(function(){$("[data-game='content']").addClass("fadeIn"),setTimeout(function(){if($("[data-game='rate']").removeClass("zoomOut").addClass("zoomIn"),rate>"50"){var diff=rate-50,array=[];array[10]="rotate-60",array[30]="rotate-80",array[50]="rotate-100",$("[data-rate='longPart']").addClass("rotate-50"),setTimeout(function(){$("[data-rate='shortPartRight']").addClass("show"),$("[data-rate='shortPartLeft']").addClass("hide"),$("[data-rate='longPart']").removeClass("rotate-50").addClass(array[diff])},505)}},350)},350)})};scope.$watch("val",function(newValue){newValue&&timer(game,200)},!0)}}}]);var gourmetCtrl=angular.module("gourmetCtrl",[]);gourmetCtrl.controller("gourmetController",function($scope,Gourmets){$scope.imagePath=imagePath,$scope.busy=!0,Gourmets.get().success(function(data){var gourmetsData=data.reverse(),length=gourmetsData.length;$scope.gourmets=gourmetsData.splice(0,24),$scope.loadMore=function(){if($scope.busy=!0,0===length)return!1;var num=12;num>length&&(num=length);var moreGourmets=gourmetsData.splice(0,num);angular.forEach(moreGourmets,function(value){$scope.gourmets.push(value)})}}),$scope.getDate=function(timestamp){var newDate=new Date(timestamp),months=["January","February","March","April","May","June","July","August","September","October","November","December"],year=newDate.getFullYear(),month=months[newDate.getMonth()],day=newDate.getDate(),date=day+" "+month+" "+year;return date}}),gourmetCtrl.directive("ngGourmet",["$timeout",function(timer){return{restrict:"A",replace:!0,scope:{val:"=gourmetsModel",busy:"=scrollBusy"},link:function(scope){var progressBar=$("[data-gourmet='progressBar']"),circleLoading=$("[data-gourmet='circleLoading']"),initLoading=function(){var item=$("[data-gourmet='item']"),length=item.length,count=0;item.each(function(){var itemImage=$("[data-gourmet='itemImage']",$(this)),src=$(itemImage).attr("src"),image=new Image;$(image).attr("src",src).bind("load",function(){count++;var value=Math.round(count/length*100);progressBar.children().css("width",value+"%").attr("aria-valuenow",value).text(value+"%"),count==length&&(progressBar.addClass("fadeOut"),item.css("display","block").attr("data-visible",1),setTimeout(function(){item.addClass("fadeIn"),circleLoading.css("display","block").addClass("fadeIn"),scope.busy=!1,scope.$apply()},350))})})},loadMore=function(){var invisibleItem=$("[data-gourmet='item'][data-visible='0']"),length=invisibleItem.length,count=0;console.log(length),scope.busy=!0,scope.$apply(),invisibleItem.each(function(){var itemImage=$("[data-gourmet='itemImage']",$(this)),src=$(itemImage).attr("src"),image=new Image;$(image).attr("src",src).bind("load",function(){count++,count==length&&(circleLoading.addClass("fadeOut"),setTimeout(function(){circleLoading.css("display","none"),invisibleItem.css("display","block"),setTimeout(function(){invisibleItem.addClass("fadeIn").attr("data-visible",1),12==length&&circleLoading.css("display","block").removeClass("fadeOut").addClass("fadeIn"),scope.busy=!1,scope.$apply()},100)},350))})})};scope.$watch("val",function(newValue,oldValue){oldValue?newValue&&timer(loadMore,200):timer(initLoading,200)},!0)}}}]);var homeCtrl=angular.module("homeCtrl",[]);homeCtrl.controller("homeController",function($scope){$scope.imagePath=imagePath}),homeCtrl.directive("ngHome",["$timeout",function(){return{restrict:"A",replace:!0,link:function(){var fullPage=$("[data-index='fullPage']"),section=$("[data-full-page='section']",fullPage),cell=$("[data-full-page='cell']",fullPage),length=section.length,windowHeight=$(window).height(),switchCount=0,scrollFullPage=function(){section.css("height",windowHeight),cell.each(function(){var cellHeight=$(this).height();$(this).css({"padding-top":(windowHeight-cellHeight)/2,"padding-bottom":(windowHeight-cellHeight)/2})}),$(window).on("scroll",function(){var top=parseInt(fullPage.css("top")),scrollTop=$(this).scrollTop();1==scrollTop&&0===switchCount&&top!==-windowHeight*(length-1)&&(fullPage.css("top",top-windowHeight),switchCount=1),-1==scrollTop&&0===switchCount&&0!==top&&(fullPage.css("top",top+windowHeight),switchCount=1),0===scrollTop&&1==switchCount&&(switchCount=0)})},image=new Image,src=imagePath+"73ad5a84dcefe956276f1bd07c6316dd.jpg",pageLoading=$("[data-component='pageLoading']");$(image).attr("src",src).bind("load",function(){pageLoading.addClass("fadeOut"),setTimeout(function(){fullPage.addClass("fadeIn")},350),scrollFullPage()})}}}]);var playStationCtrl=angular.module("playStationCtrl",[]);playStationCtrl.controller("playStationController",function($scope,Games){$scope.imagePath=imagePath,$scope.busy=!0,Games.get().success(function(data){var gamesData=data.reverse(),length=gamesData.length;$scope.games=gamesData.splice(0,24),$scope.loadMore=function(){if($scope.busy=!0,0===length)return!1;var num=12;num>length&&(num=length);var moreGames=gamesData.splice(0,num);angular.forEach(moreGames,function(value){$scope.games.push(value)})}}),$scope.getNumber=function(num){return new Array(num)}}),playStationCtrl.directive("ngPlayStation",["$timeout",function(timer){return{restrict:"A",replace:!0,scope:{val:"=gamesModel",busy:"=scrollBusy"},link:function(scope){var progressBar=$("[data-playstation='progressBar']"),circleLoading=$("[data-playstation='circleLoading']"),itemHover=function(){$("[data-playstation='item']").hover(function(){$("[data-playstation='itemImage']",$(this)).addClass("flipOutY")},function(){$("[data-playstation='itemImage']",$(this)).removeClass("flipOutY").addClass("flipInY")})},initLoading=function(){var item=$("[data-playstation='item']"),length=item.length,count=0;item.each(function(){var itemImage=$("[data-playstation='itemImage']",$(this)),src=$(itemImage).attr("src"),image=new Image;$(image).attr("src",src).bind("load",function(){count++;var value=Math.round(count/length*100);progressBar.children().css("width",value+"%").attr("aria-valuenow",value).text(value+"%"),count==length&&(progressBar.addClass("fadeOut"),item.css("display","block").attr("data-visible",1),setTimeout(function(){item.addClass("fadeIn"),circleLoading.css("display","block").addClass("fadeIn"),scope.busy=!1,scope.$apply()},350))})}),itemHover()},loadMore=function(){var invisibleItem=$("[data-playstation='item'][data-visible='0']"),length=invisibleItem.length,count=0;console.log(length),scope.busy=!0,scope.$apply(),invisibleItem.each(function(){var itemImage=$("[data-playstation='itemImage']",$(this)),src=$(itemImage).attr("src"),image=new Image;$(image).attr("src",src).bind("load",function(){count++,count==length&&(circleLoading.addClass("fadeOut"),setTimeout(function(){circleLoading.css("display","none"),invisibleItem.css("display","block"),setTimeout(function(){invisibleItem.addClass("fadeIn").attr("data-visible",1),12==length&&circleLoading.css("display","block").removeClass("fadeOut").addClass("fadeIn"),scope.busy=!1,scope.$apply()},100)},350))})}),itemHover()};scope.$watch("val",function(newValue,oldValue){oldValue?newValue&&timer(loadMore,200):timer(initLoading,200)},!0)}}}]);var gameService=angular.module("gameService",[]);gameService.factory("Game",function($http){return{get:function(game_url){return $http.get("/api/game/"+game_url)}}});var gourmetService=angular.module("gourmetService",[]);gourmetService.factory("Gourmets",function($http){return{get:function(){return $http.get("/api/gourmets")}}});var playStationService=angular.module("playStationService",[]);playStationService.factory("Games",function($http){return{get:function(){return $http.get("/api/games")}}});